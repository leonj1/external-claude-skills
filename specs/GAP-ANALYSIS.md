# Gap Analysis: Manifest Loading

> Generated by: codebase-analyst (via gherkin-to-test)
> Date: 2026-01-04
> Feature: Manifest Loading (Sub-task 1.1)
> Source: tests/bdd/manifest-loading.feature

---

## 1. Project Status

**Project Type**: Greenfield
**Existing Implementation**: None
**Directory Structure**: Standard Python project to be created

---

## 2. Feature Requirements (from BDD)

### 2.1 Scenarios to Implement

| # | Scenario | Type |
|---|----------|------|
| 1 | Successfully load a valid manifest file | Happy Path |
| 2 | Load manifest with all required skill fields | Happy Path |
| 3 | Load manifest with skill dependencies | Happy Path |
| 4 | Load manifest with task definitions | Happy Path |
| 5 | Load manifest with category definitions | Happy Path |
| 6 | Validate skill references in tasks exist | Validation |
| 7 | Validate task references in categories exist | Validation |
| 8 | Validate dependency references exist | Validation |
| 9 | Successfully validate a complete manifest | Validation |
| 10 | Handle missing manifest file | Error Handling |
| 11 | Handle invalid YAML syntax | Error Handling |
| 12 | Handle manifest with missing required sections | Error Handling |
| 13 | Handle empty manifest file | Error Handling |

**Total Scenarios**: 13 (note: scenario 14 from spec is combined)

---

## 3. Reuse Opportunities

### 3.1 Existing Code

**None** - This is a greenfield implementation.

### 3.2 Standard Libraries to Use

| Library | Purpose | Notes |
|---------|---------|-------|
| `pyyaml` | YAML parsing | External dependency |
| `dataclasses` | Data models | Standard library |
| `abc` | Interface definitions | Standard library |
| `typing` | Type hints | Standard library |

### 3.3 Patterns to Follow

- **Interface-first design**: Define `IManifestLoader`, `IManifestValidator` interfaces
- **Dataclass models**: `Skill`, `Task`, `Category`, `Manifest`
- **Custom exceptions**: `ManifestNotFoundError`, `ManifestParseError`, `ManifestValidationError`
- **Dependency injection**: Validator injected into loader

---

## 4. New Components to Build

### 4.1 Interfaces

| File | Interface | Methods |
|------|-----------|---------|
| `lib/skill_router/interfaces/manifest.py` | `IManifestLoader` | `load(path)`, `load_from_string(content)` |
| `lib/skill_router/interfaces/manifest.py` | `IManifestValidator` | `validate(manifest)` |

### 4.2 Data Models

| File | Class | Fields |
|------|-------|--------|
| `lib/skill_router/models.py` | `Skill` | name, description, path, depends_on |
| `lib/skill_router/models.py` | `Task` | name, description, triggers, skills |
| `lib/skill_router/models.py` | `Category` | name, description, tasks, skills |
| `lib/skill_router/models.py` | `Manifest` | skills, tasks, categories |

### 4.3 Exceptions

| File | Exception | Purpose |
|------|-----------|---------|
| `lib/skill_router/exceptions.py` | `ManifestError` | Base exception |
| `lib/skill_router/exceptions.py` | `ManifestNotFoundError` | File not found |
| `lib/skill_router/exceptions.py` | `ManifestParseError` | Invalid YAML |
| `lib/skill_router/exceptions.py` | `ManifestValidationError` | Reference errors |

### 4.4 Implementations

| File | Class | Implements |
|------|-------|------------|
| `lib/skill_router/manifest_loader.py` | `ManifestLoader` | `IManifestLoader` |
| `lib/skill_router/manifest_validator.py` | `ManifestValidator` | `IManifestValidator` |

---

## 5. Directory Structure (Target)

```
lib/
  skill_router/
    __init__.py
    models.py
    exceptions.py
    interfaces/
      __init__.py
      manifest.py
    manifest_loader.py
    manifest_validator.py

tests/
  unit/
    skill_router/
      test_manifest_loader.py
      test_manifest_validator.py
      test_models.py
```

---

## 6. Refactoring Required

**None** - Greenfield project.

---

## 7. Recommendations

1. **Start with models and exceptions** - These are dependencies for loader/validator
2. **Test interfaces first** - Ensure contracts are well-defined
3. **Group prompts by concern**:
   - Loading scenarios (happy paths)
   - Validation scenarios
   - Error handling scenarios

---

## 8. Verdict

**Refactoring Needed**: NO
**GO Signal**: YES - Proceed with implementation

---

## 9. Prompt Grouping Recommendation

| Prompt | Scenarios | Focus |
|--------|-----------|-------|
| 001-bdd-manifest-loading-models.md | Setup | Models, exceptions, interfaces |
| 002-bdd-manifest-loading-happy.md | 1-5 | Happy path loading |
| 003-bdd-manifest-loading-validation.md | 6-9 | Reference validation |
| 004-bdd-manifest-loading-errors.md | 10-13 | Error handling |
